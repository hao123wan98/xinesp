/*!
 * zeroModal.js
 * http://git.oschina.net/cylansad/zeroModal
 *
 * Copyright 2016, Sad
 */(function(d){"undefined"!==typeof module&&"object"===typeof exports&&define.cmd?module.exports=d:"function"===typeof define&&define.amd?define(function(){return d}):window.zeroModal=d})(function(d,h){function r(a){var b={};d.extend(b,z);d.extend(b,a);if("undefined"===typeof b.unique||""===b.unique){a=[];for(var c=0;36>c;c++)a[c]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);a[14]="4";a[19]="0123456789abcdef".substr(a[19]&3|8,1);a[8]=a[13]=a[18]=a[23]="";a=a.join("");b.unique=a}return p[b.unique]=b}function x(a){if("function"===typeof a.onOpen)a.onOpen(a);t(a);A(a)}function l(a){if("object"===typeof a){if("function"===typeof a.onCleanup)a.onCleanup();d('[zero-unique-overlay\x3d"'+a.unique+'"]').remove();d('[zero-unique-container\x3d"'+a.unique+'"]').remove();d('[zero-unique-loading\x3d"'+a.unique+'"]').remove();if("function"===typeof a.onClosed)a.onClosed()}}function t(a){n++;var b=d(document).width(),c=d(document).height();a.overlay&&(b=d('\x3cdiv zero-unique-overlay\x3d"'+a.unique+'" class\x3d"zeromodal-overlay" style\x3d"opacity:'+a.opacity+";z-index:"+n+";width:"+b+"px;height:"+c+'px"\x3e\x3c/div\x3e'),d("body").append(b),a.overlayClose?(b.css("cursor","pointer"),b.click(function(){l(a)})):b.click(function(){var b=d('[zero-unique-container\x3d"'+a.unique+'"]');if(0!==b.length){for(var c=b.position().left,g=0;2>g;g++)b.animate({left:c-2},50),b.animate({left:c},50),b.animate({left:c+2},50);b.animate({left:c},50)}}))}function A(a){n++;var b=a.width.replace("px",""),c=a.height.replace("px",""),e=d(window).width(),f=d(window).height();-1!==b.indexOf("%")&&(b=e*parseInt(b.replace("%",""))/100);-1!==c.indexOf("%")&&(c=f*parseInt(c.replace("%",""))/100);"string"===typeof b&&(b=parseInt(b));"string"===typeof c&&(c=parseInt(c));f=(e-b)/2;e=d(window).scrollTop()+Math.ceil((d(window).height()-c)/3)+"px";a.top!==h&&(e=a.top);b=d('\x3cdiv zero-unique-container\x3d"'+a.unique+'" class\x3d"zeromodal-container" style\x3d"z-index:'+n+";width:"+b+"px;height:"+c+"px;left:"+f+"px;top:"+(a.transition?e-50:e)+'"\x3e\x3c/div\x3e');d("body").append(b);a.drag&&(c=d('\x3cdiv zero-unique-top\x3d"'+a.unique+'" class\x3d"zeromodal-top"\x3e\x3c/div\x3e'),b.append(c),c="container"===a.dragHandle?d('[zero-unique-container\x3d"'+a.unique+'"]')[0]:d('[zero-unique-top\x3d"'+a.unique+'"]')[0],new y(d('[zero-unique-container\x3d"'+a.unique+'"]')[0],{handle:c,limit:!1}));c=a.titleCenter?'\x3cdiv zeromodal-unqiue-header\x3d"'+a.unique+'" class\x3d"zeromodal-header-center"\x3e':'\x3cdiv zeromodal-unqiue-header\x3d"'+a.unique+'" class\x3d"zeromodal-header"\x3e';a.close&&(c+='        \x3cdiv title\x3d"\u5173\u95ed" zero-close-unique\x3d"'+a.unique+'" class\x3d"zeromodal-close"\x3e\u00d7\x3c/div\x3e');a.max&&(c+='    \x3cdiv title\x3d"\u6700\u5927\u5316/\u53d6\u6d88\u6700\u5927\u5316" zero-max-unique\x3d"'+a.unique+'" class\x3d"zeromodal-max"\x3e\x3c/div\x3e');c+='        \x3cspan class\x3d"modal-title"\x3e'+a.title+"\x3c/span\x3e";c=d(c+"   \x3c/div\x3e");b.append(c);d('[zero-close-unique\x3d"'+a.unique+'"]').click(function(){l(p[d(this).attr("zero-close-unique")])});d('[zero-max-unique\x3d"'+a.unique+'"]').click(function(){"1"!==d(this).attr("max")?(u(p[d(this).attr("zero-max-unique")],"90%","85%"),d(this).attr("max","1")):(u(p[d(this).attr("zero-max-unique")]),d(this).attr("max","0"));w(a)});a.transition&&d(".zeromodal-container").animate({top:e},300);var g=d('\x3cdiv zero-unique-body\x3d"'+a.unique+'" class\x3d"zeromodal-body"\x3e\x3c/div\x3e');b.append(g);w(a);a.resize&&(b.append('\x3cdiv zero-unique-sweep-tee\x3d"'+a.unique+'" class\x3d"zeromodal-sweep-tee"\x3e\x3c/div\x3e'),B(a.unique,a));if("function"===typeof a.onLoad)a.onLoad(a);if(a.url)g.html('\x3cdiv class\x3d"zeromodal-loading1"\x3e\x3c/div\x3e'),a.iframe?(e=d('\x3ciframe src\x3d"'+a.url+'" class\x3d"zeromodal-frame"\x3e\x3c/iframe\x3e'),g.append(e),e.load(function(){d(".zeromodal-loading1").remove();if("function"===typeof a.onComplete)a.onComplete(a)})):(d('[zero-unique-body\x3d"'+a.unique+'"]').addClass("zeromodal-overflow-y"),d.ajax({url:a.url,dataType:"html",type:"get",success:function(b){g.append(b);d(".zeromodal-loading1").remove();if("function"===typeof a.onComplete)a.onComplete(a)}}));else if(d('[zero-unique-body\x3d"'+a.unique+'"]').addClass("zeromodal-overflow-y"),g.html(a.content),"function"===typeof a.onComplete)a.onComplete(a);C(a,b);if(a.esc)d("body").one("keyup",function(b){27===b.keyCode&&l(a)})}function C(a,b){if(a.ok||a.cancel||a.buttons!==h&&0<a.buttons.length){var c;c='\x3cdiv class\x3d"zeromodal-footer"\x3e'+(a.buttonTopLine?'\x3cdiv class\x3d"zeromodal-line"\x3e\x3c/div\x3e':"");c+='        \x3cdiv zeromodal-btn-container\x3d"'+a.unique+'" class\x3d"zeromodal-btn-container"\x3e\x3c/div\x3e';b.append(c+"   \x3c/div\x3e");if(a.buttons!==h&&0<a.buttons.length)for(c=0;c<a.buttons.length;c++){var e=a.buttons[c],f=d('\x3cbutton zero-btn-unique\x3d"'+a.unique+'" class\x3d"'+(e.className||"")+'"'+(e.attr!==h?" "+e.attr:"")+"\x3e"+e.name+"\x3c/button\x3e");"function"===typeof e.fn&&function(b){f.click(function(){var c=b.fn(a);("undefined"===typeof c||c)&&l(a)})}(e);d('[zeromodal-btn-container\x3d"'+a.unique+'"]').append(f)}else a.ok&&(c=d('\x3cbutton zeromodal-btn-ok\x3d"'+a.unique+'" class\x3d"zeromodal-btn zeromodal-btn-primary"\x3e'+a.okTitle+"\x3c/button\x3e"),d('[zeromodal-btn-container\x3d"'+a.unique+'"]').append(c),c.click(function(){if("function"===typeof a.okFn){var b=a.okFn();("undefined"===typeof b||b)&&l(a)}else l(a)})),a.cancel&&(c=d('\x3cbutton zeromodal-btn-cancel\x3d"'+a.unique+'" class\x3d"zeromodal-btn zeromodal-btn-default"\x3e'+a.cancelTitle+"\x3c/button\x3e"),d('[zeromodal-btn-container\x3d"'+a.unique+'"]').append(c),c.click(function(){if("function"===typeof a.cancelFn){var b=a.cancelFn();("undefined"===typeof b||b)&&l(a)}else l(a)}))}}function v(a){if("undefined"===typeof a||"undefined"===typeof a.cancelTitle)a.cancelTitle="\u53d6\u6d88";var b=r(a);b.width="360px";b.height="300px";b.esc=!0;b.ok=!0;b.buttonTopLine=!1;"undefined"!==typeof _okFn&&(b.okFn=_okFn);"undefined"!==typeof cancelFn&&(b.cancelFn=cancelFn);var c=b.content||"",e=b.contentDetail||"";b.content="";x(b);a="undefined"!==typeof b.iconDisplay?d(b.iconDisplay):d('\x3cdiv class\x3d"zeromodal-icon '+b.iconClass+'"\x3e'+b.iconText+"\x3c/div\x3e");c=d('\x3cdiv class\x3d"zeromodal-title1"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"zeromodal-title2"\x3e'+e+"\x3c/div\x3e");d('[zero-unique-body\x3d"'+b.unique+'"]').append(a);d('[zero-unique-body\x3d"'+b.unique+'"]').append(c);d('[zero-unique-body\x3d"'+b.unique+'"]').removeClass("zeromodal-overflow-y");d('[zeromodal-btn-ok\x3d"'+b.unique+'"]').focus();q=!0;d(window).resize(function(){q&&u(b)})}function u(a,b,c){d('[zero-unique-overlay\x3d"'+a.unique+'"]').css("width",d(document).width()+"px").css("height",d(document).height()+"px");var e=d(window).width(),f=d(window).height();b=b!==h?b.replace("px",""):a.width.replace("px","");c=c!==h?c.replace("px",""):a.height.replace("px","");-1!==b.indexOf("%")&&(b=e*parseInt(b.replace("%",""))/100);-1!==c.indexOf("%")&&(c=f*parseInt(c.replace("%",""))/100);"string"===typeof b&&(b=parseInt(b));"string"===typeof c&&(c=parseInt(c));e=(e-b)/2;f=d(window).scrollTop()+Math.ceil((d(window).height()-c)/3);d('[zero-unique-container\x3d"'+a.unique+'"]').css("width",b+"px").css("height",c+"px").css("left",e+"px").css("top",f+"px")}function D(a){var b=d(window).width();d(window).height();var c=parseInt(d('[zero-unique-container\x3d"'+a.unique+'"]').css("width").replace("px","")),e=parseInt(d('[zero-unique-container\x3d"'+a.unique+'"]').css("height").replace("px","")),b=(b-c)/2,e=d(window).scrollTop()+Math.ceil((d(window).height()-e)/3);d('[zero-unique-container\x3d"'+a.unique+'"]').css("left",b+"px").css("top",e+"px")}function w(a){var b=d('[zeromodal-unqiue-header\x3d"'+a.unique+'"]').height(),c=a.ok||a.cancel||a.buttons!==h&&0<a.buttons.length?60:0,b=d('[zero-unique-container\x3d"'+a.unique+'"]').height()-b-10-c;d('[zero-unique-body\x3d"'+a.unique+'"]').css("height",b)}function B(a,b){var c,e,f,g=!1,k=d('[zero-unique-sweep-tee\x3d"'+a+'"]')[0];d('[zero-unique-body\x3d"'+a+'"]');document.onmousemove=function(a){0!==d('[zero-unique-container\x3d"'+b.unique+'"]').size()&&(e=a.pageX,f=a.pageY,c!==h&&(g=!0))};k.onmousedown=function(){document.onselectstart=function(){return!1};var a=f-k.offsetTop,b=e-k.offsetLeft;c=setInterval(function(){if(c&&g){var h=e-b,k=f-a;d(".zeromodal-container").css("width",h+3+"px").css("height",k+3+"px")}},5)};document.onmouseup=function(){0!==d('[zero-unique-container\x3d"'+b.unique+'"]').size()&&(document.onselectstart=function(){return!0},clearInterval(c),c=h,g=!1,D(b),w(b),b.resizeAfterFn!==h&&"function"===typeof b.resizeAfterFn&&b.resizeAfterFn(b))}}function y(){this.initialize.apply(this,arguments)}var m={},z={unique:"",title:"",content:"",url:!1,iframe:!1,width:"500px",height:"300px",top:h,transition:!1,opacity:.2,overlay:!0,overlayClose:!1,drag:!0,dragHandle:"top",max:!1,resize:!1,resizeAfterFn:h,ok:!1,okTitle:"\u786e\u5b9a",okFn:!1,close:!0,cancel:!1,cancelTitle:"\u5173\u95ed",cancelFn:!0,buttonTopLine:!0,buttons:[],esc:!1,titleCenter:false,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1},q=!1,n=1E4,p={};m.show=function(a){var b=r(a);x(b);q=!0;d(window).resize(function(){q&&u(b)});return b.unique};m.close=function(a){l({unique:a});q=!1;delete p[a]};m.closeAll=function(){d('[role\x3d"zeromodal-loading"]').remove();d(".zeromodal-overlay").remove();d(".zeromodal-container").each(function(){var a=d(this),b=a.attr("zero-unique-container");if(b!==h&&p[b]!==h){var c=p[b];if("function"===typeof c.onCleanup)c.onCleanup(c);a.remove();if("function"===typeof c.onClosed)c.onClosed(c);delete p[b]}});q=!1};m.loading=function(a){var b=r();t(b);n++;var c=d(window).scrollTop()+Math.ceil(d(window).height()/3);a===h&&(a=1);if(1===a||2===a){var e="zeromodal-loading"+a;d("body").append('\x3cdiv role\x3d"zeromodal-loading" zero-unique-loading\x3d"'+b.unique+'" class\x3d"'+e+'" style\x3d"z-index:'+n+";top:"+c+'px;"\x3e\x3c/div\x3e')}else{var f;a:{f=[3,4,5,6];for(var g=0;g<f.length;g++)if(f[g]===a){f=!0;break a}f=!1}if(f){var k;switch(a){case 3:k="pacman";e=5;break;case 4:k="line-scale-pulse-out";e=5;break;case 5:k="line-spin-fade-loader";e=8;break;case 6:k="square-spin",e=1}c='\x3cdiv role\x3d"zeromodal-loading" zero-unique-loading\x3d"'+b.unique+'" class\x3d"'+k+'" style\x3d"z-index:'+n+";left:46%;top:"+c+'px;"\x3e';for(a=0;a<e;a++)c+="  \x3cdiv\x3e\x3c/div\x3e";c+="  \x3c/div\x3e";d("body").append(c)}}return b.unique};m.progress=function(a,b){var c=r();t(c);n++;a===h&&(a=3);var e=d(window).scrollTop()+Math.ceil(d(window).height()/3),f,g;switch(a){case 3:f="pacman";g=5;break;case 4:f="line-scale-pulse-out";g=5;break;case 5:f="line-spin-fade-loader";g=8;break;case 6:f="square-spin",g=1}f='\x3cdiv zero-unique-loading\x3d"'+c.unique+'" class\x3d"'+f+'" style\x3d"z-index:'+n+";left:46%;top:"+e+'px;"\x3e';for(var k=0;k<g;k++)f+="  \x3cdiv\x3e\x3c/div\x3e";f=f+"  \x3c/div\x3e"+('  \x3cdiv zero-unique-loading\x3d"'+c.unique+'" class\x3d"zeromodal-progress-content" style\x3d"z-index:'+n+";top:"+(e+64)+'px;"\x3e\x3cspan id\x3d"progess_content_'+c.unique+'"\x3e\x3c/span\x3e\x3c/div\x3e');f+="";d("body").append(f);var l=0,p=setInterval(function(){d.ajax({url:b.getProgressUrl+"?_\x3d"+(new Date).getTime(),dataType:"json",type:"get",success:function(a){d("#progess_content_"+c.unique).html(a.progress);"finish"===a.progress&&(clearInterval(p),d.get(b.clearProgressUrl),m.close(c.unique))}});l++;500<=l&&clearInterval(p)},500);return c.unique};m.progress_old=function(a){var b=r();t(b);n++;var c=d(window).scrollTop()+Math.ceil(d(window).height()/3),e=d(window).width()/2-200,f=1;a!==h&&a>f&&10>a&&(f=a);a='\x3cdiv class\x3d"zeromodal-progress" style\x3d"top:'+c+"px;left:"+e+"px;z-index:"+n+'"\x3e';a+='      \x3cdiv zeromodal-progress-bar\x3d"'+b.unique+'" class\x3d"zeromodal-progress-bar" style\x3d"width: 0%; background: #92c26a;"\x3e';a+='          \x3cspan class\x3d"zeromodal-progress-icon zeromodal-fa zeromodal-fa-check" style\x3d"border-color:#92c26a; color:#92c26a;"\x3e\x3cdiv zeromodal-progress-val\x3d"'+b.unique+'" class\x3d"zeromodal-progress-val"\x3e\x26nbsp;0%\x3c/div\x3e\x3c/span\x3e';a+="      \x3c/div\x3e  \x3c/div\x3e";d("body").append(a);var g=0,k=d('[zeromodal-progress-bar\x3d"'+b.unique+'"]'),l=d('[zeromodal-progress-val\x3d"'+b.unique+'"]'),m=setInterval(function(){g+=1;k.css("width",g+"%");l.html((9<g?g:"\x26nbsp;"+g)+"%");100<=g&&(l.html('\x3cspan class\x3d"line tip"\x3e\x3c/span\x3e\x3cspan class\x3d"line long"\x3e\x3c/span\x3e'),clearInterval(m))},100*f);return b.unique};m.alert=function(a){var b={};d.extend(b,{iconClass:"show-zero2 zeromodal-icon-info",iconText:"!"});"object"===typeof a?d.extend(b,a):b.content=a;v(b)};m.error=function(a){var b={iconDisplay:'\x3cdiv class\x3d"show-zero2 zeromodal-icon zeromodal-error"\x3e\x3cspan class\x3d"x-mark"\x3e\x3cspan class\x3d"line left"\x3e\x3c/span\x3e\x3cspan class\x3d"line right"\x3e\x3c/span\x3e\x3c/span\x3e\x3c/div\x3e'};"object"===typeof a?d.extend(b,a):b.content=a;v(b)};m.success=function(a){var b={iconDisplay:'\x3cdiv class\x3d"show-zero2 zeromodal-icon zeromodal-success"\x3e\x3cspan class\x3d"line tip"\x3e\x3c/span\x3e\x3cspan class\x3d"line long"\x3e\x3c/span\x3e\x3cdiv class\x3d"placeholder"\x3e\x3c/div\x3e\x3c/div\x3e'};"object"===typeof a?d.extend(b,a):b.content=a;v(b)};m.confirm=function(a,b){var c={};d.extend(c,{iconClass:"show-zero2 zeromodal-icon-question",iconText:"?"});"function"===typeof b&&(c.okFn=b);c.cancel=!0;"object"===typeof a?d.extend(c,a):c.content=a;v(c)};y.prototype={initialize:function(a,b){this.drag=a;this._x=this._y=0;this._moveDrag=this.bind(this,this.moveDrag);this._stopDrag=this.bind(this,this.stopDrag);this.setOptions(b);this.handle=this.options.handle;this.maxContainer=this.options.maxContainer;this.maxTop=Math.max(this.maxContainer.clientHeight,this.maxContainer.scrollHeight)-this.drag.offsetHeight;this.maxLeft=Math.max(this.maxContainer.clientWidth,this.maxContainer.scrollWidth)-this.drag.offsetWidth;this.limit=this.options.limit;this.lockX=this.options.lockX;this.lockY=this.options.lockY;this.lock=this.options.lock;this.onStart=this.options.onStart;this.onMove=this.options.onMove;this.onStop=this.options.onStop;this.handle.style.cursor="move";this.changeLayout();this.addHandler(this.handle,"mousedown",this.bind(this,this.startDrag))},changeLayout:function(){this.drag.style.top=this.drag.offsetTop+"px";this.drag.style.left=this.drag.offsetLeft+"px";this.drag.style.position="absolute";this.drag.style.margin="0"},startDrag:function(a){a=a||window.event;this._x=a.clientX-this.drag.offsetLeft;this._y=a.clientY-this.drag.offsetTop;this.addHandler(document,"mousemove",this._moveDrag);this.addHandler(document,"mouseup",this._stopDrag);a.preventDefault&&a.preventDefault();this.handle.setCapture&&this.handle.setCapture();this.onStart()},moveDrag:function(a){a=a||window.event;var b=a.clientY-this._y,c=a.clientX-this._x;this.lock||(this.lockY||(this.drag.style.top=b+"px"),this.lockX||(this.drag.style.left=c+"px"),a.preventDefault&&a.preventDefault(),this.onMove())},stopDrag:function(){this.removeHandler(document,"mousemove",this._moveDrag);this.removeHandler(document,"mouseup",this._stopDrag);this.handle.releaseCapture&&this.handle.releaseCapture();this.onStop()},setOptions:function(a){this.options={handle:this.drag,limit:!0,lock:!1,lockX:!1,lockY:!1,maxContainer:document.documentElement||document.body,onStart:function(){},onMove:function(){},onStop:function(){}};for(var b in a)this.options[b]=a[b]},addHandler:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeHandler:function(a,b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},bind:function(a,b){return function(){return b.apply(a,arguments)}}};return m}(jQuery));